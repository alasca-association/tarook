---
k8s_network_pod_subnet: 10.244.0.0/16
k8s_network_service_subnet: 10.96.0.0/12
k8s_network_pod_subnet_v6: fdff:2::/56
# The service subnet is bounded; for 128-bit addresses, the mask must be >= 108
# The service cluster IP range is validated by the kube-apiserver to have at most 20 host bits
# https://github.com/kubernetes/kubernetes/blob/v1.9.2/cmd/kube-apiserver/app/options/validation.go#L29-L32
# https://github.com/kubernetes/kubernetes/pull/12841
k8s_network_service_subnet_v6: fdff:3::/108
k8s_network_bgp_worker_as: 64512
k8s_network_bgp_gateway_as: 65000
k8s_network_calico_ipipmode: "Never"

supported_k8s_versions:
  - '1.17'
  - '1.18'
  - '1.19'
  - '1.20'
  - '1.21'
  - '1.22'
  - '1.23'

# Minor version of k8s and Calico, e.g., '1.18.9' becomes '1.18'.
k8s_version_minor: '{{ k8s_version | regex_replace("^v?(\d+.\d+)(.\d+)?$", "\1") }}'

calico_version_minor: '{{ image_version_map[k8s_version_minor].calico_version | regex_replace("^v?(\d+.\d+)(.\d+)?$", "\1") }}'

# Default image tags for 'our' services, separated by minor k8s release.
# To overwrite any of the tags you probably will have to copy the whole dict
# to your `config.toml` and make the necessary adjustments. Monitoring is
# is not included here because `kube-prometheus` comes with its own type
# of versioning.
image_version_map:
  "1.17":
    kube_router:
      kube_router: "v1.1.0"
    openstack:
      cinder_csi_plugin: "v1.19.0"
      csi_attacher: "v2.0.0"
      csi_node_driver_registrar: "v1.1.0"
      csi_provisioner: "v1.4.0"
      csi_resizer: "v0.3.0"
      csi_snapshotter: "v1.2.2"
      openstack_cloud_controller_manager: "v1.19.1"
    rook:
      ceph: "v14.2.6"
      operator: "v1.2.3"
      toolbox: "v1.2.3"
    calico_version: "{{ k8s_network_calico_custom_version  | default('3.17.1') }}" # Version of Calico binaries and images to be deployed

  "1.18":
    kube_router:
      kube_router: "v1.1.0"
    openstack:
      cinder_csi_plugin: "v1.19.0"
      csi_attacher: "v2.0.0"
      csi_node_driver_registrar: "v1.1.0"
      csi_provisioner: "v1.4.0"
      csi_resizer: "v0.3.0"
      csi_snapshotter: "v1.2.2"
      openstack_cloud_controller_manager: "v1.19.1"
    rook:
      ceph: "v14.2.6"
      operator: "v1.2.3"
      toolbox: "v1.2.3"
    calico_version: "{{ k8s_network_calico_custom_version  | default('3.17.1') }}" # Version of Calico binaries and images to be deployed

  "1.19":
    kube_router:
      kube_router: "v1.1.0"
    openstack:
      cinder_csi_plugin: "v1.19.0"
      csi_attacher: "v2.0.0"
      csi_node_driver_registrar: "v1.1.0"
      csi_provisioner: "v1.4.0"
      csi_resizer: "v0.3.0"
      csi_snapshotter: "v1.2.2"
      openstack_cloud_controller_manager: "v1.19.1"
    rook:
      ceph: "v14.2.6"
      operator: "v1.2.3"
      toolbox: "v1.2.3"
    calico_version: "{{ k8s_network_calico_custom_version  | default('3.19.0') }}" # Version of Calico binaries and images to be deployed

  "1.20":
    kube_router:
      kube_router: "v1.1.0"
    openstack:
      cinder_csi_plugin: "v1.19.0"
      csi_attacher: "v2.0.0"
      csi_node_driver_registrar: "v1.1.0"
      csi_provisioner: "v1.4.0"
      csi_resizer: "v0.3.0"
      csi_snapshotter: "v1.2.2"
      openstack_cloud_controller_manager: "v1.19.1"
    rook:
      ceph: "v14.2.6"
      operator: "v1.2.3"
      toolbox: "v1.2.3"
    calico_version: "{{ k8s_network_calico_custom_version  | default('3.19.0') }}" # Version of Calico binaries and images to be deployed

  "1.21":
    kube_router:
      kube_router: "v1.1.0"
    openstack:
      cinder_csi_plugin: "v1.19.0"
      csi_attacher: "v2.0.0"
      csi_node_driver_registrar: "v1.1.0"
      csi_provisioner: "v1.4.0"
      csi_resizer: "v0.3.0"
      csi_snapshotter: "v1.2.2"
      openstack_cloud_controller_manager: "v1.19.1"
    rook:
      ceph: "v14.2.6"
      operator: "v1.2.3"
      toolbox: "v1.2.3"
    calico_version: "{{ k8s_network_calico_custom_version  | default('3.19.0') }}" # Version of Calico binaries and images to be deployed

  "1.22":
    kube_router:
      kube_router: "v1.1.0"
    openstack:
      # https://github.com/kubernetes/cloud-provider-openstack/releases/tag/v1.24.2
      cinder_csi_plugin: "v1.24.2"
      openstack_cloud_controller_manager: "v1.24.2"
      # https://github.com/kubernetes-csi/external-attacher/releases/tag/v3.4.0
      csi_attacher: "v3.4.0"
      # https://github.com/kubernetes-csi/node-driver-registrar/releases/tag/v2.5.1
      csi_node_driver_registrar: "v2.5.1"
      # https://github.com/kubernetes-csi/external-provisioner/releases/tag/v3.1.1
      csi_provisioner: "v3.1.1"
      # https://github.com/kubernetes-csi/external-resizer/releases/tag/v1.5.0
      csi_resizer: "v1.5.0"
      # https://github.com/kubernetes-csi/external-snapshotter/releases/tag/v6.0.1
      csi_snapshotter: "v6.0.1"
      # https://github.com/kubernetes-csi/livenessprobe/releases/tag/v2.6.0
      csi_livenessprobe: "v2.6.0"
    rook:
      ceph: "v14.2.6"
      operator: "v1.2.3"
      toolbox: "v1.2.3"
    calico_version: "{{ k8s_network_calico_custom_version  | default('3.21.6') }}"

  "1.23":
    kube_router:
      kube_router: "v1.5.1"
    openstack:
      # https://github.com/kubernetes/cloud-provider-openstack/releases/tag/v1.24.2
      cinder_csi_plugin: "v1.24.2"
      openstack_cloud_controller_manager: "v1.24.2"
      # https://github.com/kubernetes-csi/external-attacher/releases/tag/v3.5.0
      csi_attacher: "v3.5.0"
      # https://github.com/kubernetes-csi/node-driver-registrar/releases/tag/v2.5.1
      csi_node_driver_registrar: "v2.5.1"
      # https://github.com/kubernetes-csi/external-provisioner/releases/tag/v3.2.1
      csi_provisioner: "v3.2.1"
      # https://github.com/kubernetes-csi/external-resizer/releases/tag/v1.5.0
      csi_resizer: "v1.5.0"
      # https://github.com/kubernetes-csi/external-snapshotter/releases/tag/v6.0.1
      csi_snapshotter: "v6.0.1"
      # https://github.com/kubernetes-csi/livenessprobe/releases/tag/v2.7.0
      csi_livenessprobe: "v2.7.0"
    rook:
      ceph: "v14.2.6"
      operator: "v1.2.3"
      toolbox: "v1.2.3"
    calico_version: "{{ k8s_network_calico_custom_version  | default('3.21.6') }}"

image_versions: "{{ image_version_map[k8s_version_minor] }}"
