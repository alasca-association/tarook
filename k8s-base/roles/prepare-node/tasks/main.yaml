---
# This role ensures that the pre requisite for Ansible is installed: python3
# As python3 is previsouly not installed on the system, gathering_facts is not run.
# Therefore we cannot use the automtic detection of the system package manager.
# Instead, we simply try them all.
- name: Ensure python is installed
  # The so-called Wood Hammer Method (haha)
  raw: |
    test -e /usr/bin/python3 || \
    sudo apt install -y python3 || \
    sudo dnf install -y python3 || \
    sudo yum install -y python3
  changed_when: false

# Cannot use facts (such as ansible_distribution) here because we may not have had python yet.
- name: Get OS family name
  raw: cat /etc/os-release | grep -i 'ID_LIKE'
  register: os_info
  changed_when: false
  failed_when: 'os_info.rc not in [0, 1]'

- name: Required package installation on RedHat family
  become: yes
  package:
    state: present
    name:
    - tar
    - wget
    - python3-cryptography
    - zip
  when: "'rhel' in os_info.stdout and 'fedora' in os_info.stdout"
