---
- name: Gather status of services
  ansible.builtin.service_facts:

- name: Gather node installation state
  ansible.builtin.set_fact:
    install_status: "{{ ('keepalived.service' in ansible_facts.services or 'haproxy.service' in ansible_facts.services or 'wg-quick@.service' in ansible_facts.services) | ternary('initialized', 'uninitialized', 'initialized') }}"  # noqa 204

- name: Group frontend nodes
  ansible.builtin.group_by:
    key: "{{ install_status }}_frontend_nodes"
...
