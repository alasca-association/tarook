---
# tasks file for k8s-fetch-certs
- name: Fetch Kubernetes certificates
  become: true
  block:
  - name: Fetch certificates file and keys from the initial master to localhost
    ansible.builtin.fetch:
      src: "/etc/kubernetes/pki/{{ item }}"
      dest: "{{ etc_dir }}/"
      flat: true
    loop: "{{ pki_cert_files }}"
    run_once: true

  - name: Fetch etcd certificates file and keys from the initial master to localhost
    ansible.builtin.fetch:
      src: "/etc/kubernetes/pki/etcd/{{ item }}"
      dest: "{{ etc_dir }}/etcd/"
      flat: true
    loop: "{{ etcd_files }}"
    run_once: true

  - name: Copy kubernetes configs to localhost
    ansible.builtin.fetch:
      src: "{{ item }}"
      dest: "{{ etc_dir }}/"
      flat: true
    with_items:
      - /etc/kubernetes/admin.conf
      - /etc/kubernetes/kubelet.conf
...
