---
- name: End play if Tigera operator is configured
  ansible.builtin.meta: end_play
  when:
    - image_versions.calico_use_tigera_operator | bool

- name: Create /etc/cni/net.d/
  become: true
  ansible.builtin.file:
    owner: root
    group: root
    mode: u=rw,g=r,o-rwx
    path: /etc/cni/net.d/
    state: directory

- name: Generate calico kubeconfig
  ansible.builtin.include_role:
    name: k8s-master
    tasks_from: mkkubeconfig
  vars:
    vault_role_id: "{{ vault_node_role_id }}"
    vault_secret_id: "{{ vault_node_secret_id }}"
    kubeconfig_title: calico
    kubeconfig_destination: /etc/cni/net.d/calico-kubeconfig
    kubeconfig_role: calico-cni
    kubeconfig_user: calico-cni
    kubeconfig_api_server_url: "https://{{ networking_fixed_ip }}:{{ k8s_apiserver_frontend_port }}"
...
