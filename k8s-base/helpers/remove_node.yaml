- name: Remove the node from the K8s cluster
  hosts: master_nodes
  gather_facts: false
  run_once: yes
  tasks:
    - name: Drain the node
      command: "kubectl drain {{ node }} --ignore-daemonsets --delete-local-data"

    - name: Delete the node from k8s
      command: "kubectl delete node {{ node }}"

    - name: Remove the VM from OpenStack
      delegate_to: localhost
      os_stack:
        name: "{{ node }}"
        state: absent
        template: "{{ playbook_dir }}/files/worker_nodes/stack.yaml"

