---
- name: Detect user
  hosts: k8s_nodes
  gather_facts: false
  # we need *all* hosts.
  any_errors_fatal: true
  vars_files:
    - vars/etc.yaml
  roles:
    - detect_user

- name: Rotate CA
  hosts: masters
  gather_facts: true
  vars_files:
    - vars/disruption.yaml
    - vars/etc.yaml
    - vars/retries.yaml
  handlers:
    - name: Import k8s-master handlers
      import_tasks: roles/k8s-master/handlers/main.yaml
  pre_tasks:
  - name: Fail if disruption is not allowed
    run_once: true
    when: not _allow_disruption
    fail:
      msg: "Disruption is not allowed."
  roles:
    - role: k8s-rotate-ca
      tags: k8s-rotate-ca
...
