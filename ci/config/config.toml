[terraform]
subnet_cidr = "172.30.154.0/24"
haproxy_ports = [30060]
workers = 6
default_master_image_name = "mk8s-ci-ubuntu-1804-nightly"
default_worker_image_name = "mk8s-ci-ubuntu-1804-nightly"
gateway_image_name = "mk8s-ci-debian-10-nightly"
worker_flavors = ["L", "M", "L", "M", "L", "M"]
enable_az_management = false
cluster_name = "ci"

# dd2a only
#azs = ["nova"]
#public_network = "floating-IPv4"

[load-balancing]
deprecated_nodeport_lb_test_port = 30060
lb_ports = ["{{ deprecated_nodeport_lb_test_port }}"]

[load-balancing.priorities]
"ci-gw-az1" = 150
"ci-gw-az2" = 100
"ci-gw-az3" = 80

[wireguard]
ip_cidr = "172.30.153.0/24"
ip_gw = "172.30.153.1/24"

[[wireguard.peers]]
pub_key = "/0VYI+LK2VYUX3E7QDUCfp7p+0vU2tocsqGFjsKoJVs="
ip = "172.30.153.14/32"
ident = "gitlab-ci-runner"

[ch-k8s-lbaas]
enabled = true
shared_secret = "IYeOlEFO1h3uc9x1bdw9thNNgmn1gm8dmzos3f04PLmFjt3d"
version = "0.3.3"
agent_port = 15203

[kubernetes]
version = "1.19.10"
use_podsecuritypolicies = true
is_gpu_cluster = false

[kubernetes.storage]
rook_enabled = true
nodeplugin_toleration = true

[kubernetes.monitoring]
enabled = true

[kubernetes.global_monitoring]
enabled = true
nodeport = 31911
nodeport_name = "ch-k8s-global-monitoring"

[kubernetes.network]
plugin = "kube-router"
pod_subnet = "10.244.0.0/16"
service_subnet = "10.96.0.0/12"

[k8s-service-layer.rook]
namespace = "rook-ceph"
cluster_name = "rook-ceph"
version = "v1.6.7"
skip_upgrade_checks = true
nodeplugin_toleration = true
nosds = 3
osd_volume_size = "90Gi"
toolbox = true
ceph_fs = true
mon_volume = true
mon_volume_storage_class = "local-storage"

mds_memory_limit = "4Gi"
mds_memory_request = "{{ rook_mds_memory_limit }}"
mds_cpu_limit = "1"
mds_cpu_request = "{{ rook_mds_cpu_limit }}"

mon_cpu_limit = "500m"
mon_cpu_request = "100m"
operator_cpu_limit = "500m"
operator_cpu_request = "100m"

scheduling_key = "{{ scheduling_key_prefix }}/storage"

[k8s-service-layer.prometheus]
use_thanos = true
thanos_objectstorage_container_name = "managed-k8s-monitoring-thanos-data"
scheduling_key = "{{ scheduling_key_prefix }}/monitoring"
prometheus_memory_limit = "1Gi"
prometheus_memory_request = "{{ monitoring_prometheus_memory_limit }}"
prometheus_cpu_request = "{{ monitoring_prometheus_cpu_limit }}"
prometheus_cpu_limit = "200m"

[testing.test-nodes]
"ci-worker-1" = "worker0"
"ci-worker-3" = "worker1"
"ci-worker-5" = "worker2"

[node-scheduling]
scheduling_key_prefix = "scheduling.mk8s.cloudandheat.com"

[node-scheduling.labels]
ci-worker-0 = ["{{ scheduling_key_prefix }}/storage=true"]
ci-worker-1 = ["{{ scheduling_key_prefix }}/monitoring=true"]
ci-worker-2 = ["{{ scheduling_key_prefix }}/storage=true"]
ci-worker-3 = ["{{ scheduling_key_prefix }}/monitoring=true"]
ci-worker-4 = ["{{ scheduling_key_prefix }}/storage=true"]
ci-worker-5 = ["{{ scheduling_key_prefix }}/monitoring=true"]

[node-scheduling.taints]
ci-worker-0 = ["{{ scheduling_key_prefix }}/storage=true:NoSchedule"]
ci-worker-2 = ["{{ scheduling_key_prefix }}/storage=true:NoSchedule"]
ci-worker-4 = ["{{ scheduling_key_prefix }}/storage=true:NoSchedule"]

[passwordstore]
rollout_company_users = false # False because we don't have the keys

[[passwordstore.additional_users]]
ident = "mk8s-ci@gitlab"
gpg_id = "mk8s-ci@gitlab"

[cah-users]
rollout = true

[miscellaneous]
wireguard_on_workers = false
