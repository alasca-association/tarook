[terraform]
subnet_cidr = "172.30.154.0/24"
haproxy_ports = [30060]
workers = 6
default_master_image_name = "mk8s-ci-ubuntu-1804-nightly"
default_worker_image_name = "mk8s-ci-ubuntu-1804-nightly"
gateway_image_name = "mk8s-ci-debian-10-nightly"
worker_flavors = ["L", "L", "L", "L", "L", "L"]
enable_az_management = false
cluster_name = "ci"

dualstack_support = false
subnet_v6_cidr = "fd00::/120"

# dd2a only
#azs = ["nova"]
#public_network = "floating-IPv4"

[load-balancing]
deprecated_nodeport_lb_test_port = 30060
lb_ports = ["{{ deprecated_nodeport_lb_test_port }}"]

[wireguard]
ip_cidr = "172.30.153.0/24"
ip_gw = "172.30.153.1/24"
ipv6_cidr = "fd01::/120"
ipv6_gw = "fd01::1/120"
port = 7777

[[wireguard.peers]]
pub_key = "MQL6dL0DSOnXTLrScCseY7Fs8S5Hb4yHc6SZ+/ucNx0="
ip = "172.30.153.14/32"
ipv6 = "fd01::14/128"
ident = "gitlab-ci-runner"

[ch-k8s-lbaas]
enabled = true
shared_secret = "IYeOlEFO1h3uc9x1bdw9thNNgmn1gm8dmzos3f04PLmFjt3d"
version = "0.3.3"
agent_port = 15203

[kubernetes]
version = "1.21.4"
use_podsecuritypolicies = false
is_gpu_cluster = false

[kubernetes.apiserver]
frontend_port = 8888

[kubernetes.storage]
rook_enabled = true
nodeplugin_toleration = true

[kubernetes.local_storage.static]
enabled = true
storageclass_name = "local-storage"

[kubernetes.local_storage.dynamic]
enabled = true
storageclass_name = "local-storage-dynamic"

[kubernetes.monitoring]
enabled = true

[kubernetes.global_monitoring]
enabled = true
nodeport = 31911
nodeport_name = "ch-k8s-global-monitoring"

[kubernetes.network]
plugin = "kube-router"
pod_subnet = "10.244.0.0/16"
service_subnet = "10.96.0.0/12"

[k8s-service-layer.rook]
namespace = "rook-ceph"
cluster_name = "rook-ceph"
version = "v1.6.7"
skip_upgrade_checks = true
nodeplugin_toleration = true
nosds = 3
osd_volume_size = "90Gi"
toolbox = true
ceph_fs = true
mon_volume = true
mon_volume_storage_class = "local-storage"

mds_memory_limit = "4Gi"
mds_memory_request = "{{ rook_mds_memory_limit }}"
mds_cpu_limit = "1"
mds_cpu_request = "{{ rook_mds_cpu_limit }}"

mon_cpu_limit = "500m"
mon_cpu_request = "100m"
mon_memory_limit = "1Gi"
mon_memory_request = "500Mi"

operator_cpu_limit = "500m"
operator_cpu_request = "100m"

scheduling_key = "{{ scheduling_key_prefix }}/storage"

[k8s-service-layer.prometheus]
use_thanos = true
thanos_objectstorage_container_name = "managed-k8s-monitoring-thanos-data"
scheduling_key = "{{ scheduling_key_prefix }}/monitoring"
prometheus_memory_limit = "1Gi"
prometheus_memory_request = "{{ monitoring_prometheus_memory_limit }}"
prometheus_cpu_request = "{{ monitoring_prometheus_cpu_limit }}"
prometheus_cpu_limit = "1"

[k8s-service-layer.cert-manager]
enabled = true

[testing.test-nodes]
"ci-worker-1" = "worker0"
"ci-worker-3" = "worker1"
"ci-worker-5" = "worker2"

[node-scheduling]
scheduling_key_prefix = "scheduling.mk8s.cloudandheat.com"

[node-scheduling.labels]
ci-worker-0 = ["{{ scheduling_key_prefix }}/storage=true"]
ci-worker-1 = ["{{ scheduling_key_prefix }}/monitoring=true"]
ci-worker-2 = ["{{ scheduling_key_prefix }}/storage=true"]
ci-worker-3 = ["{{ scheduling_key_prefix }}/monitoring=true"]
ci-worker-4 = ["{{ scheduling_key_prefix }}/storage=true"]

[node-scheduling.taints]
ci-worker-0 = ["{{ scheduling_key_prefix }}/storage=true:NoSchedule"]
ci-worker-2 = ["{{ scheduling_key_prefix }}/storage=true:NoSchedule"]
ci-worker-4 = ["{{ scheduling_key_prefix }}/storage=true:NoSchedule"]

[passwordstore]
rollout_company_users = false # False because we don't have the keys

[[passwordstore.additional_users]]
ident = "mk8s-ci@gitlab"
gpg_id = "mk8s-ci@gitlab"

[cah-users]
rollout = false

[miscellaneous]
wireguard_on_workers = false
