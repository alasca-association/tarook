---
apiVersion: v1
kind: Pod
metadata:
  name: {{ pod_name | to_json }}
  namespace: "{{ check_networkpolicy_namespace }}"
spec:
  containers:
  - image: curlimages/curl:latest
    imagePullPolicy: IfNotPresent
    name: curl
    command:
    - "sh"
    - "-c"
    - |
      set -e
      # we need to give kube-router a moment to push the changes to all
      # nodes.
      sleep 5
      curl -sS -o/dev/null{% for ip in service_pod_ips %} {{ "http://%s" | format(ip) | quote }}{% endfor %}

  restartPolicy: Never
