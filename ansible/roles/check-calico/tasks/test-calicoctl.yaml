---
- name: Define Environment
  delegate_to: "{{ groups['masters'] | first }}"
  environment:
    KUBECONFIG: /etc/kubernetes/admin.conf
    DATASTORE_TYPE: kubernetes

  block:
  - name: Check /usr/local/bin/calicoctl
    stat:
      path: /usr/local/bin/calicoctl
    register: calicoctl_stat_result
    failed_when: "( calicoctl_stat_result.stat.exists != true ) and ( calicoctl_stat_result.stat.executable != true )"

  - name: Check calicoctl nodes test command
    shell: >
      calicoctl get nodes
    register: calicoct_get_nodes
    failed_when: ( calicoct_get_nodes.stderr != "" )