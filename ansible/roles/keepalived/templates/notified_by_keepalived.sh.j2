#!/bin/bash

# This script was auto-generated by ansible. Do not modify.

{% if not ipsec_enabled %}
# No-one to notify.
exit 0
{% else %}
TYPE=$1
NAME=$2
STATE=$3

# Invoke `ip xfrm policy flush` to get rid off any IPsec residuals inside the kernel
# from a previous call.

case $STATE in
    "MASTER")
        ip xfrm policy flush
        /usr/bin/systemctl start strongswan-swanctl
        exit 0
        ;;
    "BACKUP" | "FAULT")
        /usr/bin/systemctl stop strongswan-swanctl
        ip xfrm policy flush
        exit 0
        ;;
    *)  echo "unknown state"
        exit 1
        ;;
esac
{% endif %}
