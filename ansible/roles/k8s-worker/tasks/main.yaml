- name: Test if we are already part of a cluster
  become: yes
  stat:
    path: /var/lib/kubelet/config.yaml
  register: kubelet_config

- name: Join the K8s cluster
  become: yes
  vars:
    our_address: "address: {{ ansible_host }}"
    kubeadm_out: "{{ lookup('file', '{{ etc_dir }}/kubeadm_token') }}"
  when: not kubelet_config.stat.exists
  command: "{{ kubeadm_out }} --node-name {{ inventory_hostname | quote }}"
