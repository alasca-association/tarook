- name: Create passwordstore directory
  become: no
  delegate_to: localhost
  run_once: yes
  file:
    path: "{{ etc_dir }}/passwordstore"
    state: directory

- name: Initialize passwordstore
  become: no
  delegate_to: localhost
  run_once: yes
  # Technically `pass init` might change something but this change isn't relevant for us.
  changed_when: False
  command:
  args:
    argv: >
      {%- set pass_cmd = ["pass", "init"] %}
      {%- for u in passwordstore_users %}
        {%- set _ = pass_cmd.append(u.gpg_id) %}
      {%- endfor %}
      {{- pass_cmd -}}
  environment:
    PASSWORD_STORE_DIR: "{{ etc_dir }}/passwordstore"
