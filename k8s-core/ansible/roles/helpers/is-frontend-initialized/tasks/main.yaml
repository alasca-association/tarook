---
- name: Gather status of services
  ansible.builtin.service_facts:

- name: Gather node installation state
  ansible.builtin.set_fact:
    frontend_install_status: "{{ ('keepalived.service' in ansible_facts.services or 'haproxy.service' in ansible_facts.services) | ternary('initialized', 'not_initialized') }}"  # noqa 204

- name: Group frontend nodes
  ansible.builtin.group_by:
    key: "{{ frontend_install_status }}_frontend_nodes"

...
