---
- name: Initialize node connection
  import_playbook: "connect-to-nodes.yaml"
  vars:
    target_hosts: frontend

- name: Install & configure frontend services
  hosts: frontend
  gather_facts: true
  vars_files:
  - vars/disruption.yaml
  - vars/auto_generated_preamble.yaml
  - vars/etc.yaml
  - vars/retries.yaml
  roles:
  - role: keepalived
    tags:
    - keepalived
    - frontend
  - role: haproxy
    tags:
    - haproxy
    - frontend

- name: Set static fact that frontend node is initialized
  hosts: frontend
  gather_facts: false
  tasks:
  - name: Set static fact that frontend node is initialized
    become: true
    vars:
      content:
        frontend_install_status: "initialized"
    copy:
      dest: /etc/ansible/facts.d/frontend-initialized.fact
      owner: root
      group: root
      mode: 0644
      content: "{{ content | to_json }}"
...
