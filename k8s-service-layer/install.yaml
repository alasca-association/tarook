---
- name: Kubernetes Service Layer
  hosts: orchestrator
  gather_facts: no
  vars_files:
  - vars/disruption.yaml
  pre_tasks:
    - name: include env vars
      when: ksl_vars_directory is defined
      include_vars:
        dir: "{{ ksl_vars_directory }}"
      tags:
        - always
  tags:
  - mk8s-sl
  roles:
  - role: scheduling_info_v1
    tags:
    # required for monitoring/rook too
    - mk8s-sl/monitoring
    - mk8s-sl/cert-manager
    - mk8s-sl/ingress

  - role: cert_manager_v1
    when: k8s_cert_manager_enabled
    tags:
    - mk8s-sl/cert-manager

  - role: rook_v1
    when: k8s_storage_rook_enabled
    tags:
    - mk8s-sl
    - mk8s-sl/rook

  - role: monitoring_v1
    when: k8s_monitoring_enabled
    tags:
    - mk8s-sl/monitoring
