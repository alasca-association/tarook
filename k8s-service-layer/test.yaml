---
- name: Kubernetes Service Layer Tests
  hosts: orchestrator
  gather_facts: no
  vars_files:
  - vars/retries.yaml
  pre_tasks:
    - name: include env vars
      include_vars:
        dir: "{{ ksl_vars_directory }}"
      tags:
      - always
  tags:
  - test-mk8s-sl
  - check-mk8s-sl
  roles:
  - role: cert_manager_v1_test
    when: k8s_cert_manager_enabled | bool
    tags:
    - test-mk8s-sl/cert-manager
    - check-mk8s-sl/cert-manager
    - cert_manager_v1_test
  - role: fluxcd2_v1_test
    when: (fluxcd_enabled is defined) and (fluxcd_enabled | bool)
    tags:
    - test-mk8s-sl/fluxcd
    - check-mk8s-sl/fluxcd
    - fluxcd2_v1_test
