---
- name: Create namespace
  when: k8s_monitoring_enabled
  kubernetes.core.k8s:
    apply: yes
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "{{ monitoring_namespace }}"
    validate:
      fail_on_error: yes
      strict: yes
  # Retry this task on failures
  register: k8s_apply
  until: k8s_apply is not failed
  retries: "{{ k8s_error_retries }}"
  delay: "{{ k8s_error_delay }}"

- include_tasks: kube_monitoring.yaml
  when: k8s_monitoring_enabled

- name: Install thanos
  include_role:
    name: monitoring_thanos_v1
  when: monitoring_use_thanos
...
