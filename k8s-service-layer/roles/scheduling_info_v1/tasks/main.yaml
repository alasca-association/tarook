---
- name: Set node labels
  loop: "{{ k8s_node_labels | dict2items | list }}"
  command:
  args:
    argv: "{{ ['kubectl', 'label', 'nodes', '--overwrite', item.key] + item.value }}"
  loop_control:
    label: "node {{ item.key }}; labels: {{ item.value }}"
  register: label_command
  changed_when: "'not labeled' not in label_command.stdout"

# The taint command always prints "modified", even if the taints were already
# there.
- name: Set node taints  # noqa 301
  loop: "{{ k8s_node_taints | dict2items | list }}"
  command:
  args:
    argv: "{{ ['kubectl', 'taint', 'nodes', '--overwrite', item.key] + item.value }}"
  loop_control:
    label: "node {{ item.key }}; taints: {{ item.value }}"
