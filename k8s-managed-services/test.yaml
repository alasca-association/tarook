# We test the monitoring down here because we need to give Prometheus a bit of
# time to boot and collect the first bits of data.
- name: Check monitoring
  hosts: orchestrator
  gather_facts: no
  pre_tasks:
    - name: include env vars
      when: kms_vars_directory is defined
      include_vars:
        dir: "{{ kms_vars_directory }}"
  roles:
  - role: monitoring_v2_test
    tags:
    - test-monitoring
    when: "k8s_monitoring_enabled"

  - role: device_plugin_v1_test
    tags:
    - test-gpu-support
    when: "k8s_is_gpu_cluster"
