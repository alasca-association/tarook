---
- name: Create architecture-specific service monitors
  block:
  - name: Create keepalived service monitor (frontend)
    k8s:
      state: present
      apply: yes
      definition: "{{ lookup('template', 'keepalived-service-monitor.yaml.j2') }}"
      validate:
        fail_on_error: yes
        strict: yes

  - name: Create HAProxy service monitor (frontend)
    k8s:
      state: present
      apply: yes
      definition: "{{ lookup('template', 'haproxy-service-monitor.yaml.j2') }}"
      validate:
        fail_on_error: yes
        strict: yes

  - name: Create ch-k8s-LBaaS service monitors (frontend)
    k8s:
      definition: "{{ lookup('template', 'lbaas-service-monitor.yaml.j2') }}"
      apply: yes
      validate:
        fail_on_error: yes
        strict: yes
    when: ch_k8s_lbaas_enabled

  - name: Create rook-ceph-mgr service monitor
    k8s:
      state: present
      apply: yes
      definition: "{{ lookup('template', 'rook-service-monitor.yaml.j2') }}"
      validate:
        fail_on_error: yes
        strict: yes
    when: k8s_storage_rook_enabled
